<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us">
<head>
  <link href="//gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="generator" content="Hugo 0.46-DEV" />

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>2Tweak - 很小的小练习 &middot; 细胞的作战实验室</title>

  
  <link type="text/css" rel="stylesheet" href="http://azen.me/css/print.css" media="print">
  <link type="text/css" rel="stylesheet" href="http://azen.me/css/poole.css">
  <link type="text/css" rel="stylesheet" href="http://azen.me/css/syntax.css">
  <link type="text/css" rel="stylesheet" href="http://azen.me/css/hyde.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Abril+Fatface|PT+Sans:400,400i,700">


  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/favicon.png">

  
  <link href="" rel="alternate" type="application/rss+xml" title="细胞的作战实验室" />

  
</head>

  <body class=" ">
  <div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <a href="http://azen.me/"><h1>细胞的作战实验室</h1></a>
      <p class="lead">
      Power by <a href="http://hugo.spf13.com">hugo</a>
      </p>
    </div>

    <ul class="sidebar-nav">
      <li><a href="http://azen.me/">Home</a> </li>
      <li><a href="/code/fe/"> FE </a></li><li><a href="/code/crack/"> iOS逆向 </a></li><li><a href="/code/micro/"> 微服务 </a></li>
    </ul>

    <p>&copy; 2019. All rights reserved. </p>
  </div>
</div>

    <div class="content container">
    <div class="post">
  <h1>2Tweak - 很小的小练习</h1>
  <span class="post-date">Mon, May 7, 2018</span>
  <p>&nbsp;</p>         <h1>去掉SpringBoard的未读数字</h1><h2>思路</h2><ul style="list-style-type: square;"><li>编写一个Tweak给桌面用</li><li>桌面应用：SpringBoard</li><li>路径：System/Library/CoreServices/SpringBoard.app</li><li>找到Mach-O文件</li><li>验证是否加壳 otool -l SpringBoard | grep crypt</li><li>MachOView查看是否加密</li><li>class-dump出头文件</li><li>希望查看下通知个数这个UI控件在哪里..但是没有办法用Reveal查<ul style="list-style-type: square;"><li>通过Cycript查看控件在哪</li></ul></li></ul><h2>使用Cycript寻找待修元素在哪里</h2><h3>查看根控制器的子控制器</h3><p><img class="confluence-embedded-image confluence-external-resource" width="486" src="http://img.daker.wang/wiki/1542450306507.png" data-image-src="http://img.daker.wang/wiki/1542450306507.png"></p><h3>找根控制器的Subviews - 希望找到小红点UI</h3><p><img class="confluence-embedded-image confluence-external-resource" width="486" src="http://img.daker.wang/wiki/1542450371516.png" data-image-src="http://img.daker.wang/wiki/1542450371516.png"></p><p>问题：查到的东西过多</p><p>解决：靠经验去猜</p><p><img class="confluence-embedded-image confluence-external-resource" width="486" src="http://img.daker.wang/wiki/1542450455356.png" data-image-src="http://img.daker.wang/wiki/1542450455356.png"></p><p>猜测SBIconView是图标，尝试使用Cycript隐藏之，发现桌面图标确实少了一个，说明这个控件就是图标</p><p><img class="confluence-embedded-image confluence-external-resource" height="93" src="http://img.daker.wang/wiki/1542450486484.png" data-image-src="http://img.daker.wang/wiki/1542450486484.png"></p><p>再往下看，发现关键字：Badge</p><p><img class="confluence-embedded-image confluence-external-resource" height="250" src="http://img.daker.wang/wiki/1542450524660.png" data-image-src="http://img.daker.wang/wiki/1542450524660.png"></p><p>测试之，发现就是这个东东</p><h2>查看指定类的头文件找思路</h2><h3>在class-dump中查看SBIconParallaBadgeView头文件</h3><h2>开发Theos</h2><h3>Done</h3><h1>实例二：微信UI修改</h1><h2>目标</h2><p><img class="confluence-embedded-image confluence-external-resource" width="186" src="http://img.daker.wang/wiki/1542450546031.png" data-image-src="http://img.daker.wang/wiki/1542450546031.png"></p><h2>思路</h2><ul style="list-style-type: square;"><li>通过Reveal查看UI层级，拿到类名，tableView</li><li>改数据源<ul style="list-style-type: square;"><li><img class="confluence-embedded-image confluence-external-resource" height="47" src="http://img.daker.wang/wiki/1542450605059.png" data-image-src="http://img.daker.wang/wiki/1542450605059.png"></li><li>数据源就是它所在的控制器</li></ul></li><li>找到这个控制器，修改数据源方法<ul style="list-style-type: square;"><li><img class="confluence-embedded-image confluence-external-resource" height="250" src="http://img.daker.wang/wiki/1542450644051.png" data-image-src="http://img.daker.wang/wiki/1542450644051.png"></li></ul></li></ul><h2>其它</h2><h3>脱壳</h3><p>Clutch会脱壳失败</p><p>可以使用decrypted脱壳方案进行脱壳</p><h3>编写Tweak</h3><p>numberOfSectionsInTableView这个方法需要先调用原方法，然后再+1</p><p>调用原始方法：%orig - 不写传参，所有参数会自动传入</p><p><img class="confluence-embedded-image confluence-external-resource" width="386" src="http://img.daker.wang/wiki/1542450672284.png" data-image-src="http://img.daker.wang/wiki/1542450672284.png"></p><p><img class="confluence-embedded-image confluence-external-resource" width="386" src="http://img.daker.wang/wiki/1542450699902.png" data-image-src="http://img.daker.wang/wiki/1542450699902.png"></p><p>尝试修改Cell</p><p><img class="confluence-embedded-image confluence-external-resource" height="250" src="http://img.daker.wang/wiki/1542450730154.png" data-image-src="http://img.daker.wang/wiki/1542450730154.png"></p><p> <img class="confluence-embedded-image confluence-external-resource" height="250" src="http://img.daker.wang/wiki/1542450780421.png" data-image-src="http://img.daker.wang/wiki/1542450780421.png"></p><h3>数据存储</h3><p>开关的值保存起来</p><p>方案：可以使用NSUserDefaults把当前值存起来</p><p>提示：Tweak编写的时候可以定义宏</p><p>注意：</p><p>在Hook里面写的方法，默认为替换原方法（若木有源方法，默认不生效）</p><p>新方法需要在方法名前添加%new</p><p><img class="confluence-embedded-image confluence-external-resource" width="386" src="http://img.daker.wang/wiki/1542450811572.png" data-image-src="http://img.daker.wang/wiki/1542450811572.png"></p><h3>加载图片资源</h3><h4>方案一：手机全路径</h4><p>[UIImage imageWithContentsOfFile:@&quot;全路径&quot;];</p><p>全路径意味着，从手机的跟路径开始写起。</p><h4>方案二：打包到Tweak里</h4><ol><li>新建一个layout文件夹 - Tweak默认会把layout文件夹下的文件，拷贝到手机跟路径中去</li><li>建议放图片资源的文件夹 - Device/Library/PreferenceLoader/Preferences</li><li>所以，需要在layout文件夹下放/Library/PreferenceLoader/Preferences这三个层级的文件夹</li><li>也可以放在/Library/Caches中，这个路径也是挺nice的</li></ol><h4>资源规划</h4><p>方案一：抽宏</p><p><img class="confluence-embedded-image confluence-external-resource" width="486" src="http://img.daker.wang/wiki/1542450858830.png" data-image-src="http://img.daker.wang/wiki/1542450858830.png"></p><p>方案二：利用OC语法细节</p><p>@&quot;字符串一&quot; &quot;字符串二&quot;   相当于这是一个字符串</p><p><img class="confluence-embedded-image confluence-external-resource" width="486" src="http://img.daker.wang/wiki/1542450895745.png" data-image-src="http://img.daker.wang/wiki/1542450895745.png"></p><p>#path → 把传入的path自动加双引号 <strong>宏定义的语法</strong></p><p>哈</p><h1>去掉内涵段子的广告</h1><h2>定位UI</h2><p>EssayTipCellImage</p><p><img class="confluence-embedded-image confluence-external-resource" height="250" src="http://img.daker.wang/wiki/1542450926230.png" data-image-src="http://img.daker.wang/wiki/1542450926230.png"></p><p>提示：</p><p>Reveal可以直接拿到内存地址</p><p><img class="confluence-embedded-image confluence-external-resource" height="250" src="http://wiki.daker.wang/download/attachments/67003/image2018-4-23_13-50-57.png?version=1&amp;modificationDate=1524462657512&amp;api=v2" data-image-src="http://wiki.daker.wang/download/attachments/67003/image2018-4-23_13-50-57.png?version=1&amp;modificationDate=1524462657512&amp;api=v2"></p><p>注意看右下方</p><h3>问题</h3><p>直接hook这个Cell的话有问题</p><ol><li>可能会影响其他Cell</li><li>Cell返回nil可能会Crash</li></ol><h3>方案</h3><p>Cell的数据来自模型，能不能把模型干掉呢？</p><p>猜测数组模型中，有广告模型，也有正常模型，可以把广告模型滤掉</p><h3>处理</h3><h4>找到TableView的dataSource</h4><p><img class="confluence-embedded-image confluence-external-resource" width="686" src="http://img.daker.wang/wiki/1542451002340.png" data-image-src="http://img.daker.wang/wiki/1542451002340.png"></p><h4>查看dataSource的属性，找疑似的数据源变量</h4><p><img class="confluence-embedded-image confluence-external-resource" width="686" src="http://img.daker.wang/wiki/1542451037034.png" data-image-src="http://img.daker.wang/wiki/1542451037034.png"></p><h4>还可以到class-dump出来的头文件中找到这个类查看</h4><p><img class="confluence-embedded-image confluence-external-resource" width="386" src="http://img.daker.wang/wiki/1542451075670.png" data-image-src="http://img.daker.wang/wiki/1542451075670.png"></p><h4>继续看可疑的EssayFeedListModel，发现dataList</h4><p><img class="confluence-embedded-image confluence-external-resource" height="250" src="http://img.daker.wang/wiki/1542451109948.png" data-image-src="http://img.daker.wang/wiki/1542451109948.png"></p><h4>cy中查看listModel里的dataList属性里有啥</h4><p><img class="confluence-embedded-image confluence-external-resource" height="47" src="http://img.daker.wang/wiki/1542451131199.png" data-image-src="http://img.daker.wang/wiki/1542451131199.png"></p><p>结果</p><p><img class="confluence-embedded-image confluence-external-resource" height="250" src="http://img.daker.wang/wiki/1542451196844.png" data-image-src="http://img.daker.wang/wiki/1542451196844.png"></p><h4>查看长度</h4><p><img class="confluence-embedded-image confluence-external-resource" height="52" src="http://img.daker.wang/wiki/1542451213666.png" data-image-src="http://img.daker.wang/wiki/1542451213666.png"></p><h4>猜想这个里面放的是模型，验证下，通过Cell找它对应的模型</h4><p><img class="confluence-embedded-image confluence-external-resource" height="250" src="http://img.daker.wang/wiki/1542451248067.png" data-image-src="http://img.daker.wang/wiki/1542451248067.png"></p><p>发现了SSTipModel这个模型属性。我们返回到上面的那一坨结果中，发现里面有不少SSTipModel，说明我们的猜想成立</p><p>通过MJ封装的工具也可以搂出来_listModel成员变量中所有有关SSTipModel的数据</p><p><img class="confluence-embedded-image confluence-external-resource" height="22" src="http://img.daker.wang/wiki/1542451268847.png" data-image-src="http://img.daker.wang/wiki/1542451268847.png"></p><h4>分析SSTipModel</h4><p><img class="confluence-embedded-image confluence-external-resource" height="250" src="http://img.daker.wang/wiki/1542451303291.png" data-image-src="http://img.daker.wang/wiki/1542451303291.png"></p><h4>发现它的init方法，尝试hook，让它返回nil</h4><p><img class="confluence-embedded-image confluence-external-resource" width="486" src="http://img.daker.wang/wiki/1542451330768.png" data-image-src="http://img.daker.wang/wiki/1542451330768.png"></p><h4>完成，广告被干掉了</h4><h3>其他思路</h3><h4>思路一：</h4><p><img class="confluence-embedded-image confluence-external-resource" width="486" src="http://img.daker.wang/wiki/1542451359438.png" data-image-src="http://img.daker.wang/wiki/1542451359438.png"></p><h4>思路二：</h4><p><img class="confluence-embedded-image confluence-external-resource" height="250" src="http://img.daker.wang/wiki/1542451391325.png" data-image-src="http://img.daker.wang/wiki/1542451391325.png"></p><p>细节</p><ol><li>[xxxClass class] 可以用 %c表示</li><li>如果报「方法找不到」，可以随便声明一下这个方法就好 - 见上面截图的@interface一段</li></ol><h4>思路三：</h4><p>找到发网络请求的方法，修改网络请求的返回JSON值</p><h1>腾讯视频去广告</h1><h2>启动广告</h2><h3>目标</h3><p><img class="confluence-embedded-image confluence-external-resource" height="250" src="http://img.daker.wang/wiki/1542451417335.png" data-image-src="http://img.daker.wang/wiki/1542451417335.png"></p><h3>方案</h3><h4>Reveal找到广告类</h4><p><img class="confluence-embedded-image confluence-external-resource" height="250" src="http://img.daker.wang/wiki/1542451450292.png" data-image-src="http://img.daker.wang/wiki/1542451450292.png"></p><h4>class-dump导出头文件</h4><p><img class="confluence-embedded-image confluence-external-resource" height="250" src="http://img.daker.wang/wiki/1542451475543.png" data-image-src="http://img.daker.wang/wiki/1542451475543.png"></p><h4>尝试Hook掉init方法</h4><p><img class="confluence-embedded-image confluence-external-resource" width="486" src="http://img.daker.wang/wiki/1542451501488.png" data-image-src="http://img.daker.wang/wiki/1542451501488.png"></p><h4>问题</h4><p>广告去掉了，但是黑屏了。</p><h4>解决</h4><p>发现有个showSplash方法，可以Hook它，直接调用hideSplash方法</p><p><img class="confluence-embedded-image confluence-external-resource" height="250" src="http://img.daker.wang/wiki/1542451528184.png" data-image-src="http://img.daker.wang/wiki/1542451528184.png"></p><h2>视频广告</h2><h3>目标</h3><p><img class="confluence-embedded-image confluence-external-resource" height="250" src="http://img.daker.wang/wiki/1542451557021.png" data-image-src="http://img.daker.wang/wiki/1542451557021.png"></p><h3>思路</h3><p>看下控制器，发现广告控制器和真正的视频控制器不是同一个，所以直接Hook掉广告控制器</p><h3>实现</h3><p><img class="confluence-embedded-image confluence-external-resource" height="250" src="http://img.daker.wang/wiki/1542451586309.png" data-image-src="http://img.daker.wang/wiki/1542451586309.png"></p><p>done</p><p><br /></p>
        <p>&nbsp;</p>
    
</div>


    </div>

    
  </body>
</html>