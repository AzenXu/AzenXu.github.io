<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us">
<head>
  <link href="//gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="generator" content="Hugo 0.46-DEV" />

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>3 ç½‘ç«™ä¸Šäº‘ &middot; ç»†èƒçš„ä½œæˆ˜å®éªŒå®¤</title>

  
  <link type="text/css" rel="stylesheet" href="http://azen.me/css/print.css" media="print">
  <link type="text/css" rel="stylesheet" href="http://azen.me/css/poole.css">
  <link type="text/css" rel="stylesheet" href="http://azen.me/css/syntax.css">
  <link type="text/css" rel="stylesheet" href="http://azen.me/css/hyde.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Abril+Fatface|PT+Sans:400,400i,700">


  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/favicon.png">

  
  <link href="" rel="alternate" type="application/rss+xml" title="ç»†èƒçš„ä½œæˆ˜å®éªŒå®¤" />

  
</head>

  <body class=" ">
  <div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <a href="http://azen.me/"><h1>ç»†èƒçš„ä½œæˆ˜å®éªŒå®¤</h1></a>
      <p class="lead">
      Power by <a href="http://hugo.spf13.com">hugo</a>
      </p>
    </div>

    <ul class="sidebar-nav">
      <li><a href="http://azen.me/">Home</a> </li>
      <li><a href="/code/fe/"> FE </a></li><li><a href="/code/crack/"> iOSé€†å‘ </a></li><li><a href="/code/micro/"> å¾®æœåŠ¡ </a></li>
    </ul>

    <p>&copy; 2019. All rights reserved. </p>
  </div>
</div>

    <div class="content container">
    <div class="post">
  <h1>3 ç½‘ç«™ä¸Šäº‘</h1>
  <span class="post-date">Sat, Jul 7, 2018</span>
  <p>&nbsp;</p>         <h1>0x0 CloudNativeæ¦‚è¿°</h1><p><strong>æ˜¯ä»€ä¹ˆ</strong>ï¼šå€ŸåŠ©äºå¤§è§„æ¨¡åˆ†å¸ƒå¼ç³»ç»Ÿåœ¨èµ„æºåˆ©ç”¨ä¸Šçš„çµæ´»ä½¿ç”¨ã€æœåŠ¡åŒ–æ‹†åˆ†ï¼Œæ¼”å˜å‡ºæ¥çš„ä¸€ç§è½¯ä»¶éƒ¨ç½²ã€æ¶æ„ã€ä¸Šçº¿çš„æµç¨‹æ–¹é¢çš„<strong>æœ€ä½³å®è·µ</strong></p><ul style="list-style-type: square;"><li>Cloud Nativeåœ¨äº‘åˆšå‡ºæ¥çš„æ—¶å€™å°±æœ‰äº†</li><li>æ²¡æœ‰ä»»ä½•ç»„ç»‡æ¸…æ™°å®šä¹‰äº‘åŸç”Ÿï¼Œè€Œæ˜¯ä¸€ç§ä¹ æƒ¯ç”¨æ³•å’Œæœ€ä½³å®è·µ</li></ul><p>å‚è€ƒï¼š<a href="https://baike.baidu.com/item/Cloud%20Native/19865304">ç™¾åº¦ç™¾ç§‘</a></p><h2>ç‰¹ç‚¹</h2><p><img class="confluence-embedded-image confluence-external-resource" height="215" src="http://img.daker.wang/wiki/1534915410803.png" data-image-src="http://img.daker.wang/wiki/1534915410803.png"></p><h3>æ¾è€¦åˆ(SOA)</h3><p>æ¯ä¸€ä¸ªç‹¬ç«‹æ‹†åˆ†çš„æœåŠ¡ï¼Œå…·æœ‰ç‹¬ç«‹å®Œæ•´çš„ç”Ÿå‘½å‘¨æœŸï¼Œä¸å—åˆ«çš„æœåŠ¡å½±å“å’Œåˆ¶çº¦ã€‚</p><ul style="list-style-type: square;"><li>å¾®æœåŠ¡é¢†åŸŸï¼Œæ¶‰åŠå…¶ä»–çŸ¥è¯†ç‚¹ï¼š<ul style="list-style-type: square;"><li>æœåŠ¡æ³¨å†Œ</li><li>å¾®æœåŠ¡ç½‘å…³</li><li>å¥‘çº¦è°ƒç”¨ç­‰</li></ul></li><li>ä»¥é˜²æ­¢æ¯ä¸€ä¸ªæœåŠ¡è°ƒç”¨ä¹‹é—´å‡ºç°ä¸ä¸€è‡´ä¸ç»Ÿä¸€çš„æƒ…å†µ</li></ul><h4>é¡¹ç›®å®ç°</h4><p><img class="confluence-embedded-image confluence-external-resource" height="250" src="http://img.daker.wang/wiki/1534916304367.png" data-image-src="http://img.daker.wang/wiki/1534916304367.png"></p><h3>æ— çŠ¶æ€(Stateless)</h3><p>RESTfulä¸­æåˆ°è¿‡ï¼Œ<a href="http://kyfxbl.iteye.com/blog/1831869">å‚è€ƒ</a></p><h3>ä¼¸ç¼©æ€§(<strong><span>scalability)</span></strong></h3><p>ä¼¸ç¼©æ€§åˆ†ä¸ºï¼šçºµå‘çš„ä¼¸ç¼©(scale up)ã€æ¨ªå‘çš„ä¼¸ç¼©(scale out)</p><ul style="list-style-type: square;"><li>çºµå‘ä¼¸ç¼©ï¼šç»™ä¸€ä¸ªæœºå™¨å †èµ„æºï¼Œæ€»æœ‰ä¸€ä¸ªç“¶é¢ˆä¼šå †ä¸ä¸Šå»ã€‚</li><li>æ¨ªå‘ä¼¸ç¼©ï¼šæˆ‘ä»¬æŠŠæœåŠ¡è®¾è®¡æˆå¯æ¨ªå‘æ‰©å±•çš„æ¨¡å¼ï¼Œèƒ½æ‰©å±•500å°æœºå™¨ï¼Œå°±æ˜¯ä¼¸ç¼©æ€§</li></ul><h3>å†—ä½™</h3><p>åªæœ‰ä¸€ä¸ªèŠ‚ç‚¹æä¾›æœåŠ¡ï¼ŒæŒ‚äº†å°±æ²¡äº†ã€‚ç”¨å†—ä½™åšå¤‡ç”¨ï¼Œæé«˜å¯é æ€§</p><h4>é¡¹ç›®å®ç°</h4><p><img class="confluence-embedded-image confluence-external-resource" height="250" src="http://img.daker.wang/wiki/1534916378576.png" data-image-src="http://img.daker.wang/wiki/1534916378576.png"></p><p>æ— çŠ¶æ€ï¼šæˆ‘ä»¬çš„æ¡ˆä¾‹ä¸­ï¼Œæ¯ä¸€ä¸ªServerå·²ç»æ˜¯æ— çŠ¶æ€çš„äº†ï¼Œæœ¬èº«ä¸å­˜ä»»ä½•ä¸œè¥¿ï¼Œåªæä¾›APIï¼ˆé™¤äº†sessionä¹‹å¤–ï¼‰</p><p>ä¼¸ç¼©å’Œå†—ä½™ï¼šé€šè¿‡åŠ LB(è´Ÿè½½å‡è¡¡)å®ç°</p><h3>å¹³å°æ— å…³æ€§</h3><p>AWSä¸Šçš„ä¸œä¸œï¼Œåªç”¨éå¸¸å°‘çš„æˆæœ¬ï¼Œå¯ä»¥è¿ç§»åˆ°é˜¿é‡Œäº‘ä¸Š</p><ul style="list-style-type: square;"><li>åœ¨å…¬æœ‰äº‘ä¸Šï¼Œå¯ä»¥é¢„è§çš„æ˜¯ä¸€å®šä¸ä¼šå‡ºç°ä¸€å®¶ç‹¬å¤§çš„æƒ…å†µã€‚</li><li>ç°æœ‰å¯é æ€§é«˜çš„åšæ³•ï¼š<ul style="list-style-type: square;"><li>æŠŠåº”ç”¨åˆ†åˆ«éƒ¨ç½²åœ¨ä¸åŒçš„äº‘ä¸Š<ul style="list-style-type: square;"><li>ç”¨é˜¿é‡Œäº‘çš„CDNï¼Œè…¾è®¯äº‘çš„è®¡ç®—å­˜å‚¨</li><li>ä¹Ÿå¯ä»¥æŒ‰ç…§ä¸šåŠ¡æ‹†åˆ†ï¼šç”¨æˆ·ä¿¡æ¯æ”¾åœ¨é˜¿é‡Œäº‘ï¼Œå•†å“ä¿¡æ¯æ”¾åœ¨åä¸ºäº‘</li></ul></li></ul></li></ul><h4>é¡¹ç›®å®ç°</h4><p><img class="confluence-embedded-image confluence-external-resource" height="250" src="http://img.daker.wang/wiki/1534916573483.png" data-image-src="http://img.daker.wang/wiki/1534916573483.png"></p><h5>OSS</h5><p>æˆ‘ä»¬ä¹‹å‰æŠŠä¸Šä¼ çš„è§†é¢‘ç›´æ¥å­˜åœ¨nativeï¼Œè¿™æ ·ä¸å®‰å…¨</p><p>æ­£ç¡®çš„æ–¹æ³•ï¼šä½¿ç”¨å½“å‰äº‘å¹³å°çš„å­˜å‚¨æœåŠ¡ - é˜¿é‡Œäº‘OSS æˆ– ä¸ƒç‰›äº‘</p><h5>Data Base</h5><p>å¯ä»¥è‡ªå·±éƒ¨ç½²ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨äº‘å¹³å°çš„ - äº‘å¹³å°çš„ä¼šæ¯”è¾ƒè´µ</p><h2>éƒ¨ç½²å’Œå‘å¸ƒ</h2><p><img class="confluence-embedded-image confluence-external-resource" height="250" src="http://img.daker.wang/wiki/1534916669444.png" data-image-src="http://img.daker.wang/wiki/1534916669444.png"></p><p>è‡ªåŠ¨åŒ–éƒ¨ç½²ï¼šèƒ½ç”¨æœºå™¨çš„åˆ«ç”¨äººæ‰‹æ•²ï¼ˆæœ‰ç›¸å…³å·¥å…·ï¼Œæˆ‘ä»¬åœ¨æœ¬é¡¹ç›®ä¸­ä½¿ç”¨è„šæœ¬è¿›è¡ŒåŠè‡ªåŠ¨éƒ¨ç½²ï¼‰</p><p>è‰¯å¥½çš„è¿ç§»æ€§ï¼šå’ŒCloudNativeçš„ã€Œå¹³å°æ— å…³æ€§ã€ç›¸å‘¼åº”ï¼Œå¯ä»¥å¾ˆå¿«çš„è¿ç§»åˆ°å…¶ä»–äº‘å¹³å°ä¸Š</p><p>å¤šäº‘å…±ç”Ÿï¼šä¸è¦æŠŠé¸¡è›‹æ”¾åœ¨åŒä¸€ä¸ªç¯®å­é‡Œ</p><h1>0x1 ä½¿ç”¨OSSåšè§†é¢‘ä¸Šä¼ åŠæ’­æ”¾</h1><p><a href="https://www.aliyun.com/product/oss?spm=a2c4g.11186623.2.9.4jFKoz">é˜¿é‡Œäº‘OSSæ–‡æ¡£</a></p><p>SSO:Â <span>Object Storage ServiceÂ <span>ä½¿ç”¨OSSï¼Œæ‚¨å¯ä»¥é€šè¿‡ç½‘ç»œéšæ—¶å­˜å‚¨å’Œè°ƒç”¨åŒ…æ‹¬æ–‡æœ¬ã€å›¾ç‰‡ã€éŸ³é¢‘å’Œè§†é¢‘ç­‰åœ¨å†…çš„å„ç§éç»“æ„åŒ–æ•°æ®æ–‡ä»¶</span></span></p><h2>è´¹ç”¨ä¸è´­ä¹°</h2><table class="wrapped confluenceTable" style="text-align: center;"><colgroup><col /><col /><col /><col /><col /></colgroup><tbody><tr><td style="text-align: left;" class="confluenceTd">èµ„è´¹é¡¹</td><td style="text-align: left;" class="confluenceTd">è®¡è´¹é¡¹</td><td style="text-align: left;" class="confluenceTd">æ ‡å‡†å‹å•ä»·</td><td style="text-align: left;" class="confluenceTd">ä½é¢‘è®¿é—®å‹å•ä»·</td><td style="text-align: left;" class="confluenceTd">å½’æ¡£å‹å•ä»·</td></tr><tr><td style="text-align: left;" class="confluenceTd">å­˜å‚¨è´¹ç”¨<span style="color: rgb(24,156,239);">(æ³¨â‘ )</span></td><td style="text-align: left;" class="confluenceTd">æ•°æ®å­˜å‚¨</td><td style="text-align: left;" class="confluenceTd">0.12å…ƒ/GB/æœˆ</td><td style="text-align: left;" class="confluenceTd">0.08å…ƒ/GB/æœˆ</td><td style="text-align: left;" class="confluenceTd">0.033/GB/æœˆ</td></tr><tr><td style="text-align: left;" class="confluenceTd">æµé‡è´¹ç”¨<span style="color: rgb(24,156,239);">(æ³¨â‘ )</span></td><td style="text-align: left;" class="confluenceTd">å†…/å¤–ç½‘æµå…¥æµé‡ï¼ˆæ•°æ®ä¸Šä¼ åˆ°OSSï¼‰</td><td style="text-align: left;" class="confluenceTd">å…è´¹</td><td style="text-align: left;" class="confluenceTd">å…è´¹</td><td style="text-align: left;" class="confluenceTd">å…è´¹</td></tr><tr><td style="text-align: left;" class="confluenceTd"><br /></td><td style="text-align: left;" class="confluenceTd">å†…ç½‘æµå‡ºæµé‡ï¼ˆé€šè¿‡ECSäº‘æœåŠ¡å™¨ä¸‹è½½OSSçš„æ•°æ®ï¼‰</td><td style="text-align: left;" class="confluenceTd">å…è´¹</td><td style="text-align: left;" class="confluenceTd">å…è´¹</td><td style="text-align: left;" class="confluenceTd">å…è´¹</td></tr><tr><td style="text-align: left;" class="confluenceTd"><br /></td><td style="text-align: left;" class="confluenceTd">å¤–ç½‘æµå‡ºæµé‡</td><td style="text-align: left;" class="confluenceTd">00:00-08:00ï¼ˆé—²æ—¶ï¼‰ï¼š0.25å…ƒ/GB<br />8:00-24:00ï¼ˆå¿™æ—¶ï¼‰ï¼š0.50å…ƒ/GB</td><td style="text-align: left;" class="confluenceTd">00:00-08:00ï¼ˆé—²æ—¶ï¼‰ï¼š0.25å…ƒ/GB<br />8:00-24:00ï¼ˆå¿™æ—¶ï¼‰ï¼š0.50å…ƒ/GB</td><td style="text-align: left;" class="confluenceTd">00:00-08:00ï¼ˆé—²æ—¶ï¼‰ï¼š0.25å…ƒ/GB<br />8:00-24:00ï¼ˆå¿™æ—¶ï¼‰ï¼š0.50å…ƒ/GB</td></tr><tr><td style="text-align: left;" class="confluenceTd"><br /></td><td style="text-align: left;" class="confluenceTd">CDNå›æºæµå‡ºæµé‡</td><td style="text-align: left;" class="confluenceTd">0.15å…ƒ/GB</td><td style="text-align: left;" class="confluenceTd">0.15å…ƒ/GB</td><td style="text-align: left;" class="confluenceTd">0.15å…ƒ/GB</td></tr><tr><td style="text-align: left;" class="confluenceTd"><br /></td><td style="text-align: left;" class="confluenceTd">è·¨åŒºåŸŸå¤åˆ¶æµé‡</td><td style="text-align: left;" class="confluenceTd">0.50å…ƒ/GB</td><td style="text-align: left;" class="confluenceTd">0.50å…ƒ/GB</td><td style="text-align: left;" class="confluenceTd">0.50å…ƒ/GB</td></tr><tr><td style="text-align: left;" class="confluenceTd">è¯·æ±‚è´¹ç”¨</td><td style="text-align: left;" class="confluenceTd">æ‰€æœ‰è¯·æ±‚ç±»å‹</td><td style="text-align: left;" class="confluenceTd">0.01å…ƒ/ä¸‡æ¬¡</td><td style="text-align: left;" class="confluenceTd">0.1å…ƒ/ä¸‡æ¬¡</td><td style="text-align: left;" class="confluenceTd">0.1å…ƒ/ä¸‡æ¬¡</td></tr><tr><td style="text-align: left;" class="confluenceTd">æ•°æ®å¤„ç†è´¹ç”¨Â <span style="color: rgb(24,156,239);">(æ³¨â‘¡)</span></td><td style="text-align: left;" class="confluenceTd">å›¾ç‰‡å¤„ç†</td><td style="text-align: left;" class="confluenceTd">æ¯æœˆ0-10TBï¼šå…è´¹<br />&gt;10TBï¼š0.025å…ƒ/GB</td><td style="text-align: left;" class="confluenceTd">æ¯æœˆ0-10TBï¼šå…è´¹<br />&gt;10TBï¼š0.025å…ƒ/GB</td><td style="text-align: left;" class="confluenceTd">æ— </td></tr><tr><td style="text-align: left;" class="confluenceTd"><br /></td><td style="text-align: left;" class="confluenceTd">è§†é¢‘æˆªå¸§</td><td style="text-align: left;" class="confluenceTd">0.1å…ƒ/åƒå¼ </td><td style="text-align: left;" class="confluenceTd">0.1å…ƒ/åƒå¼ </td><td style="text-align: left;" class="confluenceTd">æ— </td></tr><tr><td style="text-align: left;" class="confluenceTd"><br /></td><td style="text-align: left;" class="confluenceTd">æ•°æ®å–å›</td><td style="text-align: left;" class="confluenceTd">å…è´¹</td><td style="text-align: left;" class="confluenceTd">0.0325å…ƒ/GB</td><td style="text-align: left;" class="confluenceTd">0.06å…ƒ/GB</td></tr></tbody></table><p><span><span><a href="https://www.aliyun.com/price/product?spm=5176.7933691.744462.price2.5afb6a56343Lgg#/oss/detail">å‚è€ƒé“¾æ¥</a></span></span></p><p><span><span>å­˜å‚¨è´¹ç”¨å¯ä»¥ä¹°å­˜å‚¨åŒ…ï¼Œåšæ´»åŠ¨99å—é’±1T 3å¹´</span></span></p><p><span><span>æµé‡è´¹ç”¨çš„è¯ï¼Œä¸Šä¼ å…è´¹ï¼Œä¸‹è½½å†…ç½‘æµå‡ºå…è´¹...æˆ‘ä»¬çš„è§†é¢‘ç½‘ç«™å…¶å®æ˜¯ç”¨webæœåŠ¡å™¨åšä»£ç†çš„ï¼Œæ‰€ä»¥åº”è¯¥ç®—æ˜¯å†…ç½‘æµé‡å§...åº”è¯¥æ˜¯å…è´¹çš„...</span></span></p><p><span><span>ä¸ç„¶å°±ä¹°ä¸ª99å—é’±å„¿1Tçš„å§...ç©·å•ŠğŸ˜‚</span></span></p><p>ã„Ÿ...å…¶å®9å—é’±ä¹°ä¸ª40G1å¹´çš„å°±è¡Œå§...è€æƒ³è´ªå°ä¾¿å®œå•ŠğŸ™ˆ</p><p><span><span>ä¹°çš„å­˜å‚¨åŒ…ï¼š</span></span></p><p><span><span><img class="confluence-embedded-image confluence-external-resource" height="250" src="http://img.daker.wang/wiki/1534918792766.png" data-image-src="http://img.daker.wang/wiki/1534918792766.png"></span></span></p><h2>ä»‹ç»åŠé…ç½®</h2><p><img class="confluence-embedded-image confluence-external-resource" height="250" src="http://img.daker.wang/wiki/1534919204130.png" data-image-src="http://img.daker.wang/wiki/1534919204130.png"></p><p>Bucketï¼šç”¨æ¥å­˜æ”¾æ–‡ä»¶çš„åœ°æ–¹</p><p>EndPointï¼šåˆ†ä¸ºä¸‰ä¸ªï¼Œç”¨å“ªä¸ªåœ°å€è®¿é—®å®ƒä¸Šä¼ æ–‡ä»¶ï¼Œå–å†³äºä½ çš„è™šæ‹Ÿæœºåœ¨å“ª - å†…ç½‘è®¿é—®æµé‡å…è´¹~~</p><p>åœ°å€ï¼šæˆ‘ä»¬çš„ESCåœ¨ååŒ—äºŒï¼Œæ‰€ä»¥OSSä¹Ÿç”¨ååŒ—äºŒçš„</p><h2>è§†é¢‘ä¸Šä¼ /ä¸‹è½½ä»£ç æ”¹é€ </h2><p>ä¹‹å‰çš„ä¸Šä¼ ã€ä¸‹è½½ï¼Œæ˜¯webserverä½œä¸ºä»£ç†ï¼ŒæŠŠçœŸæ­£çš„è¯·æ±‚å‘ç»™9001ç«¯å£çš„StreamServerï¼ŒStreamServeræŠŠæ–‡ä»¶å­˜åˆ°æœ¬åœ° | ä»æœ¬åœ°è¯»æ–‡ä»¶ä½œä¸ºæµä¼ ç»™webserver</p><p>æ”¹é€ æ–¹æ¡ˆ</p><ul style="list-style-type: square;"><li>æ’­æ”¾è§†é¢‘çš„æ—¶å€™ï¼Œstream serveråªéœ€è¦åš301é‡å®šå‘å°±å¥½ï¼Œè®©webServerç›´æ¥åšOSSçš„ä»£ç†æœåŠ¡å™¨ï¼ˆPS.å†…ç½‘ï¼Œä¾æ—§ä¸æ”¶æµé‡è´¹çš„ï¼‰</li><li>ä¸Šä¼ æ–‡ä»¶çš„æ—¶å€™ï¼Œå…ˆä¼ åˆ°stream serverï¼Œstream serverå†æŠŠæ–‡ä»¶è½¬å­˜åˆ°OSSï¼Œæœ€åæŠŠstream serveræœ¬åœ°çš„æ–‡ä»¶å¹²æ‰</li></ul><h3>ä¸Šä¼ æ–¹æ¡ˆåŠæ”¹é€ </h3><p>è¦ç»™OSSä¼ æ–‡ä»¶ï¼Œä¸€å®šä¸èƒ½ç›´æ¥é€šè¿‡jsåšä¸Šä¼  - å› ä¸ºjsç›¸å½“äºæ˜æ–‡ï¼Œä¼šæŠŠOSSç»™çš„å„ç§tokenæš´éœ²æ‰</p><p>ä¸‰ç§å®‰å…¨çš„ä¸Šä¼ æ–¹æ¡ˆï¼š</p><p><img class="confluence-embedded-image confluence-external-resource" height="129" src="http://img.daker.wang/wiki/1534920081352.png" data-image-src="http://img.daker.wang/wiki/1534920081352.png"></p><p>ç‰¹ç‚¹ï¼šæˆ‘ä»¬é€‰æ‹©æœ€ç®€å•çš„ç¬¬ä¸€ç§ï¼Œå®‰å…¨æ€§é«˜ï¼Œæ€§èƒ½è¾ƒä½ï¼Œä¸éœ€è¦å¼€å¯è·¨åŸŸè®¿é—®</p><p>SDKï¼š<a href="https://github.com/aliyun/aliyun-oss-go-sdk">é˜¿é‡Œäº‘OSS</a></p><blockquote><p><span style="color: rgb(106,115,125);">go get <a href="http://github.com/aliyun/aliyun-oss-go-sdk/oss">github.com/aliyun/aliyun-oss-go-sdk/oss</a></span></p></blockquote><p><br /></p><p>goçš„åŒ…ç®¡ç†ï¼š</p><p>å¯ä»¥ä½¿ç”¨vendorï¼ŒæŠŠæ‰€æœ‰çš„ç¬¬ä¸‰æ–¹åŒ…éƒ½æ”¾åˆ°vendoræ–‡ä»¶å¤¹ä¸‹ï¼Œvendoræ–‡ä»¶å¤¹æ”¾åœ¨é¡¹ç›®çš„æ ¹ç›®å½•ä¸‹</p><ul style="list-style-type: square;"><li>ä¸ç”¨æ‹…å¿ƒç»å¯¹åœ°å€å’Œgopathçš„å†²çª</li><li>vendoråœ¨å·¥ç¨‹ä¸Šæ˜¯éå¸¸æœ‰ç”¨çš„</li></ul><p><br /></p><p>å®ç°æ–‡ä»¶ä¸Šä¼ çš„utilæ–¹æ³•</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="075ca4fc-5d5c-446d-ab91-2c1a7e282807" data-macro-schema-version="1" style="background-image: url(/plugins/servlet/confluence/placeholder/macro-heading?definition=e2NvZGV9&amp;locale=zh_CN&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>package ossops

import (
   "github.com/aliyun/aliyun-oss-go-sdk/oss"
)

var EndPoint string
var AccessKeyId string
var AccessKeySecret string

func init() {
   EndPoint = ""
   AccessKeyId = ""
   AccessKeySecret = ""
}

func UploadToOss(filename string, path string, bucketname string) (ok bool) {
   client, err := oss.New(EndPoint, AccessKeyId, AccessKeySecret)
   if err != nil {
      // HandleError(err)
      return false
   }

   bucket, err := client.Bucket("my-bucket")
   if err != nil {
      // HandleError(err)
      return false
   }

   err = bucket.UploadFile(filename, path, 500 * 1024, oss.Routines(3))
   if err != nil {
      // HandleError(err)
      return false
   }

   return true
}</pre></td></tr></table><p>UploadFile(pa1, pa2, ä¸Šä¼ çš„æ¯ä¸ªchunkå¤§å°, å¹¶å‘ä¸Šä¼ æ•°é‡)</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="0504087e-8569-4163-bf0a-99b970c95cfa" data-macro-schema-version="1" style="background-image: url(/plugins/servlet/confluence/placeholder/macro-heading?definition=e2NvZGV9&amp;locale=zh_CN&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>func uploadHandler(writer http.ResponseWriter, request *http.Request, params httprouter.Params) {
    // ...
    ok := ossops.UploadToOss("/videos/"+fn, uri, "daker-wang-video"); if !ok {
      fmt.Println("ä¸Šä¼ åˆ°äº‘OSSå¤±è´¥", err)
      response.SendErrorResponse(writer, defs.ErrorInternalFaults)
      return
   } else {
      //  ä¸Šä¼ æˆåŠŸï¼Œå¹²æ‰nativeæ–‡ä»¶
      os.Remove(uri)
   }

   //  æŠ¥å‘Šç»“æœ
   response.SendNormalResponse(writer, "upload successful", http.StatusCreated)
}</pre></td></tr></table><p>ä¸Šä¼ åˆ°æœ¬åœ°æœåŠ¡å™¨æˆåŠŸåï¼Œå¾€é˜¿é‡Œäº‘ä¼ ã€‚æˆåŠŸååˆ æ‰æœ¬åœ°æ–‡ä»¶ã€‚</p><h3>æ’­æ”¾æ–¹æ¡ˆåŠæ”¹é€ </h3><p>æ”¹é€ å‰ï¼š</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="bbb79d2b-cf66-48d0-b89c-0a28ab28ce68" data-macro-schema-version="1" style="background-image: url(/plugins/servlet/confluence/placeholder/macro-heading?definition=e2NvZGV9&amp;locale=zh_CN&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>func streamHandler(writer http.ResponseWriter, request *http.Request, params httprouter.Params) {
   //  æ‰¾åˆ°æ–‡ä»¶
   fn := params.ByName("vid-id")
   uri := filePath + fn
   //  æ‰“å¼€æ–‡ä»¶ - ä¸æ˜¯è¯»äºŒè¿›åˆ¶å“¦ioutil.ReadAll()
   file, e := os.Open(uri)
   defer file.Close()

   if e != nil {
      log.Error(e.Error())
      response.SendErrorResponse(writer, defs.ErrorInternalFaults)
      return
   }

   //  å†™å¤´
   writer.Header().Set("Content-Type", "video/mp4")

   //  å†™æµ
   http.ServeContent(writer, request, "", time.Now(), file)
}</pre></td></tr></table><p>æ”¹é€ åï¼š</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="9c4ed46d-9a12-4185-bdb6-6aa940cf15df" data-macro-schema-version="1" style="background-image: url(/plugins/servlet/confluence/placeholder/macro-heading?definition=e2NvZGV9&amp;locale=zh_CN&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>func streamHandler(writer http.ResponseWriter, request *http.Request, params httprouter.Params) {
   filename := "/videos/" + params.ByName("vid-id")
   bucket := "daker-wang-video.oss-cn-beijing-internal.aliyuncs.com"
   uri := bucket + filename

   log.Info("â˜ï¸è½¬å‘åˆ°OSSæœåŠ¡å™¨ %s", filename)
   
   http.Redirect(writer, request, uri, http.StatusMovedPermanently)
}</pre></td></tr></table><h1>0x2 é…ç½®ä¿®æ”¹</h1><p>åšéƒ¨ç½²çš„æ—¶å€™ï¼Œä¸€èˆ¬ä¼šæœ‰ä¸€ä¸ªç»Ÿä¸€çš„é…ç½®æ–‡ä»¶ï¼Œç”¨æ¥æ ¹æ®ä¸åŒçš„æœåŠ¡å’Œæ¨¡å—åšä¸åŒçš„é…ç½®ã€‚</p><p>æˆ‘ä»¬éœ€è¦æŠŠé…ç½®æŠ½å‡ºæ¥å†™åœ¨åŒä¸€ä¸ªåœ°æ–¹ç®¡ç†ï¼Œå¦‚ä¸€ä¸ªæ–‡ä»¶ä¸­</p><p>å¾®æœåŠ¡æ¶æ„ä¸‹ï¼Œæœ‰æˆç™¾ä¸Šåƒçš„æœåŠ¡ï¼Œåªæœ‰ä¸€ä¸ªæ–‡ä»¶ä¼šå¸¦æ¥å¾ˆå¤šä¸ä¾¿ï¼Œéœ€è¦ä¸€ä¸ªé…ç½®æœåŠ¡å™¨</p><ul style="list-style-type: square;"><li>å¦‚<a href="https://www.cnblogs.com/sanyuanempire/p/6169517.html">CMDBé…ç½®æœåŠ¡å™¨</a></li><li>ç”¨æ¥åˆ·æ–°ã€ä¿®æ”¹å„ç§é…ç½®</li></ul><p>å¾…é…ç½®å†…å®¹ï¼š</p><ol><li>è´Ÿè½½å‡è¡¡æœåŠ¡å™¨åœ°å€<ol><li>æŒ‰ç…§æˆ‘ä»¬ä¹‹å‰çš„è¯´æ˜ï¼Œä¸‰ä¸ªåç«¯æœåŠ¡éƒ½æŒ‚è½½LBä¸Šï¼Œå‰ç«¯æœåŠ¡é€šè¿‡LBè®¿é—®åç«¯æœåŠ¡(å¿˜äº†çš„è¯å¯ä»¥è¿”å›å»çœ‹ä¸€ä¸‹é¡¶éƒ¨çš„æ¶æ„å›¾)</li></ol></li><li>OSSåœ°å€</li></ol><h2>ä½¿ç”¨Vendorç®¡ç†å…¬å…±èµ„æº</h2><p>å¦‚æœæˆ‘ä»¬ç»™æ¯ä¸ªserveréƒ½å¤åˆ¶ç²˜è´´ä¸€ä¸ªConfig.goæ–‡ä»¶ï¼Œä¼šå¾ˆéš¾ç»´æŠ¤ã€‚</p><p>å¯ä»¥ä½¿ç”¨Vendoræ–‡ä»¶å¤¹æ¥è§£å†³å…±æœ‰æ–‡ä»¶é—®é¢˜</p><p>Vendoræ–‡ä»¶å¤¹ï¼Œç”¨æ¥æ”¾ç¬¬ä¸‰æ–¹åŒ… &amp; å…±ç”¨æ–‡ä»¶</p><p><img class="confluence-embedded-image confluence-external-resource" height="250" src="http://img.daker.wang/wiki/1534928106878.png" data-image-src="http://img.daker.wang/wiki/1534928106878.png"></p><p>config.goæ–‡ä»¶ç”¨æ¥è¯»å–é…ç½®æè¿°æ–‡ä»¶å¹¶æŠŠé…ç½®è§£æå‡ºæ¥</p><ul style="list-style-type: square;"><li>é”™è¯¯ä¸€å®šè¦panicæ‰ï¼Œä¸è®©æœåŠ¡èµ·æ¥</li></ul><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="c606d375-a9bb-48a7-afc3-18abad319602" data-macro-schema-version="1" style="background-image: url(/plugins/servlet/confluence/placeholder/macro-heading?definition=e2NvZGV9&amp;locale=zh_CN&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>package config

import (
   "os"
   "encoding/json"
)

type Configuration struct {
   LBAddress string `json:"lb_address"`
   OSSAddress string `json:"oss_address"`
}

var configuration *Configuration

func init() {
   file, _ := os.Open("./config.json ")
   defer file.Close()

   decoder := json.NewDecoder(file)
   config := &amp;Configuration{}

   err := decoder.Decode(config); if err != nil {
      panic(err)
   }
}

func GetLBAddress() (lbAddress string) {
   return configuration.LBAddress
}

func GetOSSAddress() (ossAddress string) {
   return configuration.OSSAddress
}</pre></td></tr></table><h2>å¼•ç”¨Vendorä¸­çš„èµ„æº</h2><p>vendoræ–‡ä»¶å¤¹ä¸­çš„å¼•ç”¨ï¼Œå˜çš„éå¸¸ç®€å•ï¼šé€šè¿‡æ ¹ç›®å½•ä¸‹çš„ç¬¬ä¸€æ¡å­ç›®å½•æ¥ç´¢å¼•éœ€è¦çš„åŒ…å³å¯</p><p><strong>ä¸¾ä¸ªæ —å­ğŸŒ°</strong></p><p>å‰é¢è®²åˆ°çš„ossops.goæ–‡ä»¶ï¼Œå¼•ç”¨vendorä¸­çš„configç¤ºä¾‹</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="bebba355-de90-4aa8-b9cc-23c19ba66bb5" data-macro-schema-version="1" style="background-image: url(/plugins/servlet/confluence/placeholder/macro-heading?definition=e2NvZGV9&amp;locale=zh_CN&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>package ossops

import (
   "github.com/aliyun/aliyun-oss-go-sdk/oss"
   "azen/config" // æ³¨æ„è¿™é‡Œ
)

var EndPoint string
var AccessKeyId string
var AccessKeySecret string

func init() {
   EndPoint = config.GetOSSAddress()
   AccessKeyId = ""
   AccessKeySecret = ""
}</pre></td></tr></table><h1>0x3 è´Ÿè½½å‡è¡¡æœåŠ¡å™¨</h1><p>å¼€å§‹çš„æ—¶å€™ï¼Œæˆ‘ä»¬çš„apiè½¬å‘æ˜¯äº¤ç»™webæœåŠ¡å™¨æ¥åšçš„ã€‚ä¸ºäº†å®ç°Cloud Nativeçš„ã€Œä¼¸ç¼©æ€§ã€å’Œã€Œå†—ä½™ã€ï¼Œæˆ‘ä»¬å¼•å…¥äº†LBæœåŠ¡å™¨ã€‚</p><p>éœ€è¦è®©ä¸‰ä¸ªåç«¯æœåŠ¡å™¨æŒ‚è½½åœ¨LBä¸Šï¼ŒwebæœåŠ¡é€šè¿‡LBå’Œåç«¯æœåŠ¡äº¤äº’ã€‚</p><h2>å¼€é€šé˜¿é‡Œäº‘LB</h2><p><img class="confluence-embedded-image confluence-external-resource" width="686" src="http://img.daker.wang/wiki/1534929769691.png" data-image-src="http://img.daker.wang/wiki/1534929769691.png"></p><p>å®ä¾‹ç±»å‹é€‰æ‹©ã€Œç§ç½‘ã€ï¼Œç½‘ç»œç±»å‹é€‰æ‹©ã€Œä¸“æœ‰ç½‘ç»œã€ï¼Œå®ä¾‹è§„æ ¼ä¸ºã€Œæ€§èƒ½å…±äº«å‹å®ä¾‹ã€å¯ä»¥å†…ç½‘å…è´¹ä½¿ç”¨è´Ÿè½½å‡è¡¡æœåŠ¡å™¨</p><p><img class="confluence-embedded-image confluence-external-resource" width="686" src="http://img.daker.wang/wiki/1534930047061.png" data-image-src="http://img.daker.wang/wiki/1534930047061.png"></p><p>æŒ‚è½½å¥½ESCå®ä¾‹</p><p><img class="confluence-embedded-image confluence-external-resource" width="686" src="http://img.daker.wang/wiki/1534930226769.png" data-image-src="http://img.daker.wang/wiki/1534930226769.png"></p><p>æ·»åŠ ç«¯å£ç›‘å¬</p><p><img class="confluence-embedded-image confluence-external-resource" height="250" src="http://img.daker.wang/wiki/1534930417382.png" data-image-src="http://img.daker.wang/wiki/1534930417382.png"></p><p>å‰ç«¯åè®®é»˜è®¤ä¸ºTCPï¼Œä¸€èˆ¬æƒ…å†µä¸‹æ˜¯å››å±‚ç½‘ç»œï¼Œéœ€è¦é…ç½®è¿æ¥ä»€ä¹ˆçš„</p><p>è¿ç»´æ–°æ‰‹å¯ä»¥é€‰æ‹©HTTPï¼Œä½¿ç”¨ä¸ƒå±‚è´Ÿè½½å‡è¡¡ï¼Œç›¸å¯¹ç®€å•ï¼Œå‰ç«¯ä½¿ç”¨httpè¿›æ¥çš„è¯·æ±‚ï¼Œä¼šåˆ†åˆ«è½®è¯¢åç«¯æŒ‚è½½çš„æ‰€æœ‰ç«¯å£</p><p><img class="confluence-embedded-image confluence-external-resource" height="250" src="http://img.daker.wang/wiki/1534930583480.png" data-image-src="http://img.daker.wang/wiki/1534930583480.png"></p><p>ç«¯å£å·9000æ˜¯æˆ‘ä»¬çš„api serverç«¯å£ï¼Œç»‘å®šå¥½å°±å¥½ã€‚ç±»ä¼¼çš„è¿˜æœ‰stream serverç«¯å£</p><p>ç¬¬äºŒæ­¥çš„ã€Œå¥åº·æ£€æŸ¥ã€å¯ä»¥å…³é—­</p><p><img class="confluence-embedded-image confluence-external-resource" width="686" src="http://img.daker.wang/wiki/1534930733896.png" data-image-src="http://img.daker.wang/wiki/1534930733896.png"></p><p>å·²ç»å¼€å§‹ç›‘å¬äº†</p><h2>æ”¹é€ web server</h2><p>ä¹‹å‰ç›´æ¥è½¬å‘ç»™å¯¹åº”çš„åç«¯serverï¼Œæ”¹å˜ä¸ºè½¬å‘ç»™LBã€‚</p><p>Proxy:</p><pre><br /></pre><p><span style="color: rgb(48,190,71);"><s>&quot;http://localhost:9001&quot;</s> â†’Â </span>&quot;http://&quot; + <span style="color: rgb(144,119,198);">config</span>.<span style="color: rgb(255,227,123);">GetLBAddress</span>() + <span style="color: rgb(48,190,71);">&quot;:9001&quot;</span></p><p><span style="color: rgb(48,190,71);"><span style="color: rgb(51,51,51);">è½¬å‘:</span></span></p><p><span style="color: rgb(101,152,198);">u</span>.<span style="color: rgb(91,198,0);">Host </span>= <span style="color: rgb(48,190,71);">&quot;localhost&quot; </span>+ <span style="color: rgb(48,190,71);">&quot;:&quot; </span>+ <span style="color: rgb(101,152,198);">u</span>.<span style="color: rgb(255,227,123);">Port</span>()Â  â†’Â Â Â <span style="color: rgb(101,152,198);">u</span>.<span style="color: rgb(91,198,0);">Host </span>= <span style="color: rgb(144,119,198);">config</span>.<span style="color: rgb(255,227,123);">GetLBAddress</span>() + <span style="color: rgb(48,190,71);">&quot;:&quot; </span>+ <span style="color: rgb(101,152,198);">u</span>.<span style="color: rgb(255,227,123);">Port</span>()</p><h2>æ•°æ®åŒæ­¥é—®é¢˜</h2><p>è´Ÿè½½å‡è¡¡æœåŠ¡å™¨ä¸ºäº†ä¿è¯æœåŠ¡çš„å¯ç”¨æ€§ï¼Œéœ€è¦åšã€Œå†—ä½™å¤„ç†ã€ï¼Œapi server 1å’Œapi serverÂ 2äº’ä¸ºå¯¹æ–¹çš„å†—ä½™ã€‚</p><p>ä½†æ˜¯ï¼Œç”±äºæˆ‘ä»¬çš„æœåŠ¡ä¸­æœ‰ç±»ä¼¼sessionsè¿™ç§åœ¨å†…å­˜ä¸­å­˜åœ¨çš„ä¸œä¸œï¼Œå¦‚æœ1å’Œ2æ²¡åšå†…å­˜ä¸­çš„sessionsåŒæ­¥ï¼Œå°±ä¼šå‡ºç°æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µã€‚</p><p>è§£å†³æ–¹æ¡ˆï¼š</p><p>æ–¹æ¡ˆä¸€ï¼šä½¿ç”¨Redisç‹¬ç«‹æœåŠ¡åŒæ—¶ä½œä¸º1å’Œ2çš„ç¼“å­˜æœåŠ¡å™¨ï¼Œ1å’Œ2éƒ½å»Redisä¸­æ‰¾æ•°æ®</p><p>æ–¹æ¡ˆäºŒï¼šCacheå’Œdbå¼ºåˆ¶åŒæ­¥æ•°æ® - 1ä¸­å¦‚æœæ²¡æœ‰æ•°æ®ï¼Œå°±å»dbä¸­æ‰¾</p><ul style="list-style-type: square;"><li>é—®é¢˜ï¼šdbè®¿é—®é€Ÿåº¦æ…¢ï¼Œå¯èƒ½è¢«å µæ­»</li><li>è¦æ±‚ä¸¥è‹›çš„ç½‘ç«™å»ºè®®ç”¨ç¬¬ä¸€ç§è§£å†³æ–¹æ¡ˆ</li></ul><h1>0x4 ECSé…ç½®</h1><p>ä¹°æœåŠ¡çš„è¯ä¹°å°±å¥½äº†...ä¹‹å‰ä¹°äº†ä¸ªç®€å•çš„å°æœåŠ¡ï¼Œä½†æ˜¯è·‘JAVAè™šæ‹Ÿæœºè¯´å†…å­˜ä¸å¤Ÿ...å‡äº†é…ä»¥åå¥½è´µå•ŠğŸ™ˆ</p><p>é…ç½®çš„è¯æ³¨æ„é…ç½®ä¸€ä¸‹ã€Œå®ä¾‹å®‰å…¨ç»„ã€ç­–ç•¥ï¼Œå¦‚æœå‘ç°å†…ç½‘çš„æœåŠ¡ä¸èƒ½ç›¸äº’è°ƒåˆ°æŠ¥è¶…æ—¶ï¼Œå¯ä»¥å°è¯•ä¿®æ”¹ä¸‹å®‰å…¨ç»„ç­–ç•¥ã€‚</p><h1>0x5 Dispatcherä»£ç æ”¹é€ </h1><p>Dispatcherä¹‹å‰çš„åˆ é™¤æ“ä½œï¼Œåªåˆ é™¤äº†æœ¬åœ°Videoã€‚éœ€è¦ä½¿ç”¨OSSç›¸å…³æ“ä½œå¹²æ‰OSSä¸­çš„ç›¸å…³èµ„æº</p><p>ä»£ç æ¯”è¾ƒç®€å•ï¼Œå°±ä¸è´´å•¦~</p><h1>0x6 éƒ¨ç½²åŠä¸Šäº‘</h1><p>æ‰‹å·¥éƒ¨ç½²éå¸¸ä¸åˆ’ç®—ï¼Œåœ¨ç‚¹äº®ã€Œk8s &amp; dockerã€æŠ€èƒ½ç‚¹ä¹‹å‰ï¼Œæˆ‘ä»¬ç”¨åŠè‡ªåŠ¨éƒ¨ç½²ï¼ˆè„šæœ¬éƒ¨ç½²ï¼‰</p><p>æˆ‘ä»¬ä¼šåšçš„äº‹æƒ…ï¼š</p><ol><li>build productionè„šæœ¬ï¼šæ¯æ¬¡buildå‡ºæ¥ï¼Œä¸Šä¼ åˆ°gitlab</li><li>deployè„šæœ¬ï¼šä»äº‘æœåŠ¡ç«¯æ‹‰ä¸‹æ¥buildå¥½çš„äºŒè¿›åˆ¶åŒ…ï¼Œéƒ¨ç½²åœ¨æœ¬åœ°å¹¶æŠŠæœåŠ¡èµ·èµ·æ¥</li><li>sqlè„šæœ¬ï¼šåˆ›è¡¨çš„è„šæœ¬</li></ol><p><br /></p><p>åˆ›å»ºä¸€ä¸ªbinæ–‡ä»¶å¤¹ï¼Œæ”¾æ‰“åŒ…åçš„ä¸œè¥¿</p><ul style="list-style-type: square;"><li>ç”Ÿäº§ç¯å¢ƒæ‰“åŒ…åçš„ä¸œè¥¿åº”è¯¥æ”¾åˆ°ã€Œéƒ¨ç½²æœåŠ¡å™¨ã€ï¼Œç„¶åå†æ¨ä¸Šå»</li><li>è¿™é‡Œæ¯”è¾ƒç®€é™‹ï¼Œç›´æ¥ä¼ åˆ°gitlabäº†ï¼Œå› ä¸ºéƒ¨ç½²æœåŠ¡æ¯”è¾ƒè´µ...è´«ç©·é™åˆ¶äº†æˆ‘...</li></ul><p><br /></p><p>binç›®å½•ä¸‹å†™å¥½config.jsonæ–‡ä»¶ï¼Œç”¨äºæœåŠ¡èµ·èµ·æ¥ä»¥åè¯»å–é…ç½®ï¼ˆossåœ°å€å’ŒBLåœ°å€ï¼‰</p><ul style="list-style-type: square;"><li>lb_addressåœ¨æœ¬åœ°çš„æ—¶å€™ï¼Œç”¨localhostå°±å¥½</li><li>éƒ¨ç½²åˆ°æœåŠ¡ç«¯ä»¥åï¼Œéœ€è¦æ”¹ä¸ºLBçš„çœŸå®åœ°å€ï¼ˆå†…ç½‘ï¼‰</li></ul><h2>åˆ›å»ºè„šæœ¬</h2><p>buildprod.sh</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="e6ca7ca3-8275-4056-b1ca-4f0435f7d933" data-macro-schema-version="1" style="background-image: url(/plugins/servlet/confluence/placeholder/macro-heading?definition=e2NvZGV9&amp;locale=zh_CN&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>#! /bin/bash

# ç¼–è¯‘webã€apiã€streamã€dispatcherå››ä¸ªæœåŠ¡

cd ${GOPATH}/src/daker.wang/Azen/Go-execise/Streaming/api
env GOOS=linux GOARCH=amd64 go build -o ../../bin/api

cd ${GOPATH}/src/daker.wang/Azen/Go-execise/Streaming/dispatcher
env GOOS=linux GOARCH=amd64 go build -o ../../bin/dispatcher

cd ${GOPATH}/src/daker.wang/Azen/Go-execise/Streaming/stream
env GOOS=linux GOARCH=amd64 go build -o ../../bin/stream

cd ${GOPATH}/src/daker.wang/Azen/Go-execise/Streaming/web
env GOOS=linux GOARCH=amd64 go build -o ../../bin/web</pre></td></tr></table><p><br /></p><p>deploy.sh</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="d07f1d03-fc65-44f2-aabb-ae14f41827c5" data-macro-schema-version="1" style="background-image: url(/plugins/servlet/confluence/placeholder/macro-heading?definition=e2NvZGV9&amp;locale=zh_CN&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>#!/usr/bin/env bash

# éƒ¨ç½²è„šæœ¬
cp ./template ./bin/

mkdir ./bin/videos

cd bin

nohup ./api &amp;
nohup ./dispatcher &amp;
nohup ./stream &amp;
nohup ./web &amp;


echo  "ğŸ‰ deploy done~ have fun~~~"</pre></td></tr></table><p>æˆ‘ä»¬ä¹‹å‰ä¸Šä¼ videoä¼šå…ˆä¼ åˆ°æœ¬åœ°ï¼Œæ‰€ä»¥éœ€è¦åˆ›å»ºä¸€ä¸ªvideosæ–‡ä»¶å¤¹</p><p>èµ·æœåŠ¡ï¼š</p><ul style="list-style-type: square;"><li>nohupæŒ‡ä»¤ï¼šæ‰“å°ä¸ä¼šè¾“å‡ºåˆ°terminalä¸­ï¼Œè€Œæ˜¯æ‰“å°åˆ°nohub.logæ–‡ä»¶ä¸­</li><li>&amp; è¡¨ç¤ºä»¥åå°ç¨‹åºçš„æ–¹å¼èµ·æœåŠ¡ï¼Œç±»ä¼¼dockerçš„-itä»€ä¹ˆçš„</li></ul><p><br /></p><p>initdb.sql - åˆ›è¡¨çš„</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="92ac5668-a0b2-4c49-924a-bc5a361e6423" data-macro-schema-version="1" style="background-image: url(/plugins/servlet/confluence/placeholder/macro-heading?definition=e2NvZGV9&amp;locale=zh_CN&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>create table comments (
 id varchar(64) not null,
 video_id varchar(64),
 author_id int(10),
 content text,
 time datetime default current_timestamp, primary key(id)
);

create table sessions (
 session_id tinytext not null,
 TTL tinytext,
 login_name text
);
alter table sessions add primary key (session_id(64));

create table users (
 id int unsigned not null auto_increment,
 login_name varchar(64),
 pwd text not null,
 unique key (login_name),
 primary key (id)
);

create table video_del_rec (
 video_id varchar(64) not null,
 primary key (video_id)
);</pre></td></tr></table><p>æ³¨æ„ï¼š</p><p>1.sessionè¡¨è®¾ç½®ä¸»é”®å¾ˆæ€ªå¼‚ï¼ŒåŸå› åœ¨äºå¸¸è§„è®¾ç½®æ³•æ— æ³•æŠŠtinytextè®¾ç½®ä¸ºä¸»é”®ã€‚è¿™æ ·è®¾ç½®çš„ç›®çš„æ˜¯ç»•å¼€è¿™ä¸ªé™åˆ¶</p><p>2.ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæˆ‘ä»¬çš„åº“ä¸­ä¸åº”è¯¥å­˜pwdï¼Œè€Œæ˜¯åº”è¯¥å­˜åŠ å¯†ä¹‹åçš„ä¸² - å‡ å¹´å‰CSDNçš„å¯†ç è¢«æ˜æ–‡å­˜åœ¨äº†æ•°æ®åº“ä¸­å¯¼è‡´æ³„å¯†</p><h2>å¼€å§‹éƒ¨ç½²</h2><ol><li>æœ¬åœ°è¿è¡Œbuildprod.sh</li><li>pushåˆ°gitä»“åº“</li><li>äº‘æœåŠ¡å™¨ä¸Šä»gitä»“åº“æ‹‰æ–‡ä»¶</li><li>ç¼–è¾‘config.jsonï¼Œå†™æ­£ç¡®çš„addressä»¬</li><li>è¿è¡Œdeploy.sh</li><li>æ£€æŸ¥å››ä¸ªæœåŠ¡æœ‰æœ¨æœ‰è·‘èµ·æ¥<ol><li>ps aux | grep api ...</li></ol></li></ol><p><br /></p><p>æ‰“å®Œæ”¶å·¥</p>
        <p>&nbsp;</p>
    
</div>


    </div>

    
  </body>
</html>