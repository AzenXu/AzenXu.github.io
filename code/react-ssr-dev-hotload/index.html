<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us">
<head>
  <link href="//gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <meta name="generator" content="Hugo 0.46-DEV" />

  
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>2 Reactå‰ç«¯å·¥ç¨‹æ¶æ„ - å¼€å‘ç¯å¢ƒå®æ—¶æ›´æ–° &middot; ç»†èƒçš„ä½œæˆ˜å®éªŒå®¤</title>

  
  <link type="text/css" rel="stylesheet" href="http://azen.me/css/print.css" media="print">
  <link type="text/css" rel="stylesheet" href="http://azen.me/css/poole.css">
  <link type="text/css" rel="stylesheet" href="http://azen.me/css/syntax.css">
  <link type="text/css" rel="stylesheet" href="http://azen.me/css/hyde.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Abril+Fatface|PT+Sans:400,400i,700">


  
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
  <link rel="shortcut icon" href="/favicon.png">

  
  <link href="" rel="alternate" type="application/rss+xml" title="ç»†èƒçš„ä½œæˆ˜å®éªŒå®¤" />

  
</head>

  <body class=" ">
  <div class="sidebar">
  <div class="container sidebar-sticky">
    <div class="sidebar-about">
      <a href="http://azen.me/"><h1>ç»†èƒçš„ä½œæˆ˜å®éªŒå®¤</h1></a>
      <p class="lead">
      An elegant open source and mobile first theme for <a href="http://hugo.spf13.com">hugo</a> made by <a href="http://twitter.com/mdo">@mdo</a>. Originally made for Jekyll.
      </p>
    </div>

    <ul class="sidebar-nav">
      <li><a href="http://azen.me/">Home</a> </li>
      
    </ul>

    <p>&copy; 2018. All rights reserved. </p>
  </div>
</div>

    <div class="content container">
    <div class="post">
  <h1>2 Reactå‰ç«¯å·¥ç¨‹æ¶æ„ - å¼€å‘ç¯å¢ƒå®æ—¶æ›´æ–°</h1>
  <span class="post-date">Wed, Sep 19, 2018</span>
  <p>&nbsp;</p>         <p>dev server &amp; hot loadç›¸å…³commit</p><p><a href="https://gitee.com/azen/FE-execise/commit/c1cb475ef49a8cc4eacb6bc2bb3c4faaecb6e51f">ç›¸å…³commit</a></p><p><a href="https://gitee.com/azen/FE-execise/commit/01690c5e36ad221a981480891bde1855646e7e7f">è§£å†³hot loadç¼“æ…¢çš„commit</a></p><p>æœåŠ¡ç«¯å®æ—¶æ¸²æŸ“ç›¸å…³commit</p><p><a href="https://gitee.com/azen/FE-execise/commit/dd48c1a7d3a8502dd9313fb7fd494739b6c06fe6">æœåŠ¡ç«¯å®æ—¶æ¸²æŸ“</a></p><h1>0x0 é—®é¢˜ &amp; è§£å†³æ–¹æ¡ˆæ¦‚è¿°</h1><p><strong>é—®é¢˜ä¸€</strong>ï¼šæ¯æ¬¡clientä»£ç æ”¹åŠ¨ï¼Œéƒ½éœ€è¦æ‰‹åŠ¨é‡æ–°ç¼–è¯‘æ‰“åŒ…ï¼Œå¯¼è‡´å¼€å‘æ•ˆç‡ä½ä¸‹</p><p><strong>å·¥å…·</strong>ï¼šwebpack dev server</p><ul style="list-style-type: square;"><li>é€šè¿‡webpacké…ç½®ï¼Œå¯åŠ¨ä¸€ä¸ªèµ„æºserver<ul style="list-style-type: square;"><li>æœåŠ¡äºï¼šcss js htmlç­‰é™æ€èµ„æºæ–‡ä»¶</li><li>ä½œç”¨ï¼šå¯ä»¥é€šè¿‡è¯¥serverè®¿é—®åˆ°è¿™äº›èµ„æº</li></ul></li><li>åŸç†ï¼š<ol><li>æ–‡ä»¶åœ¨ç¼–è¯‘çš„è¿‡ç¨‹ä¸­ï¼Œä¼šå­˜åœ¨serverçš„å†…å­˜ä¸­</li><li>æ¯å½“æ–‡ä»¶æœ‰å˜åŒ–ï¼Œä¼šè‡ªåŠ¨æ‰§è¡Œç¼–è¯‘è¿‡ç¨‹</li><li>åˆ·æ–°æµè§ˆå™¨å°±èƒ½çœ‹åˆ°æ•ˆæœ</li></ol></li></ul><p><strong>é—®é¢˜äºŒ</strong>ï¼šæ¯æ¬¡ä»£ç å˜åŠ¨ï¼Œéƒ½éœ€è¦åˆ·æ–°æµè§ˆå™¨æ‰èƒ½çœ‹åˆ°æ•ˆæœï¼Œå¼€å‘æ•ˆç‡ä½ä¸‹</p><p><strong>å·¥å…·</strong>ï¼šhot module replacement</p><ul style="list-style-type: square;"><li>ä»£ç å˜åŠ¨ï¼Œå¯ä»¥åœ¨é¡µé¢ä¸Šæ— åˆ·æ–°çš„ç«‹åˆ»çœ‹åˆ°æ•ˆæœ</li><li>ä¿æŒå½“å‰çŠ¶æ€ï¼Œä¸ç”¨é‡æ–°è·å–æ•°æ®</li></ul><h1>0x1 åŠ¨æ€ç¼–è¯‘</h1><h2>1 åŠŸèƒ½å¯åŠ¨</h2><p>å®‰è£…webpack-dev-server</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="f8a47faa-fcb5-47ef-a2b7-f40b71ee32d3" data-macro-schema-version="1" style="background-image: url(/plugins/servlet/confluence/placeholder/macro-heading?definition=e2NvZGV9&amp;locale=zh_CN&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>npm i webpack-dev-server -D</pre></td></tr></table><p>ä¿®æ”¹æ–‡ä»¶</p><p>webpack.config.client.js</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="d5c5ba5d-4221-4a82-b2ac-bb7dfa14e714" data-macro-schema-version="1" style="background-image: url(/plugins/servlet/confluence/placeholder/macro-heading?definition=e2NvZGV9&amp;locale=zh_CN&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>...
const isDev = process.env.NODE_ENV === "development";
...
const config = {
    ...
    mode: 'production'
};
if (isDev) {
    config.devServer = {
        host: '0.0.0.0',
        port: '8787',
        contentBase: path.join(__dirname, '../dist'),
        hot: false,
        overlay: {
            error: true
        },
        publicPath: '/public',
        historyApiFallback: {
            index: '/public/index.html'
        },
    }
}

module.exports = config;</pre></td></tr></table><p>è¯´æ˜ï¼š</p><ol><li>é€šè¿‡å¯åŠ¨webpackçš„æ—¶ï¼Œä¼ å…¥çš„å‚æ•°ï¼Œåˆ¤æ–­å½“å‰ç¯å¢ƒ</li><li>è‹¥ä¸ºdevï¼Œåˆ™é…ç½®devserver<ol><li>contentBaseåº”è¯¥å’Œæ¥¼ä¸Šçš„outputçš„pathä¸€è‡´</li><li>hotï¼šæ˜¯å¦å¯åŠ¨hot module replacement<ul style="list-style-type: square;"><li>å› ä¸ºè¿˜æ²¡åšç›¸å…³é…ç½®ï¼Œæš‚æ—¶å…³æ‰</li></ul></li><li>overlayï¼šå‘ç”Ÿå“ªäº›æƒ…å†µï¼Œéœ€è¦åœ¨æµè§ˆå™¨å¼¹çª—æç¤º</li><li>publicPathï¼šæŠŠé™æ€èµ„æºè‡ªåŠ¨æŒ‚è½½åˆ°publicPathè·¯å¾„ä¸‹<ul style="list-style-type: square;"><li>åº”è¯¥å’Œconfigä¸­çš„publicPathå¯¹åº”</li></ul></li><li>historyApiFallbackï¼šhistoryä¸­å¯ä»¥é…ç½®å¾ˆå¤šå¯¹åº”å…³ç³»<ol><li>é…ç½®ä¹‹åï¼Œæˆ‘ä»¬æ‰€æœ‰æ— æ³•è¿”å›çš„404çš„å†…å®¹ï¼Œéƒ½ä¼šè¿”å›ç»™æµè§ˆå™¨è¿™ä¸ªindex.htmlæ–‡ä»¶</li></ol></li></ol></li><li>ã€æ³¨æ„ã€‘è·‘devæœåŠ¡å™¨ä¹‹å‰ï¼Œéœ€è¦å¹²æ‰ä¹‹å‰æœ¬åœ°ç¼–è¯‘ç”Ÿæˆçš„/distç›®å½•<ul style="list-style-type: square;"><li>dev serverä¼šæ£€æµ‹ç¡¬ç›˜ä¸Šæœ‰æœ¨æœ‰distè¿™ä¸ªç›®å½•ï¼Œæœ‰çš„è¯ç›´æ¥è®¿é—®è¿™ä¸ªç›®å½•ä¸‹çš„jsæ–‡ä»¶ï¼Œæ²¡åŠæ³•åŠ¨æ€ç¼–è¯‘äº†</li></ul></li></ol><p>Â é…ç½®æœåŠ¡å™¨å¯åŠ¨æ–¹æ³•</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="5fa97090-f96c-4fd3-9cbb-fb9cda70c47d" data-macro-schema-version="1" style="background-image: url(/plugins/servlet/confluence/placeholder/macro-heading?definition=e2NvZGV9&amp;locale=zh_CN&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>{
  ...
  "scripts": {
    ...
    "dev:client": "cross-env NODE_ENV=development  webpack-dev-server --config build/webpack.config.client.js",
    ...
},</pre></td></tr></table><p>è¯´æ˜ï¼š</p><ul style="list-style-type: square;"><li>cross-envï¼šä¸€ä¸ªæŠ¹å¹³æ“ä½œç³»ç»Ÿå·®å¼‚çš„åŒ…ï¼Œéœ€è¦å®‰è£…å®ƒ `npm i cross-env -D`</li></ul><p>æ•ˆæœï¼š</p><ul style="list-style-type: square;"><li>ä¿®æ”¹é™æ€èµ„æºç›¸å…³ä»£ç åï¼Œæµè§ˆå™¨ä¼šè‡ªåŠ¨åˆ·æ–°ï¼Œå±•ç°æ–°å†…å®¹å‡ºæ¥ - å†ä¹Ÿä¸ç”¨`npm run build:client`äº†</li></ul><h1>0x2 çƒ­æ›´æ–°</h1><p>é…ç½®å¥½dev serverä¹‹åï¼Œå¯ä»¥å®ç°ã€Œè‡ªåŠ¨ç¼–è¯‘ã€åŠŸèƒ½</p><p>çƒ­æ›´æ–°å¸Œæœ›è¾¾æˆçš„æ•ˆæœï¼Œæ˜¯ã€Œä¸ç”¨åˆ·æ–°é¡µé¢ã€å±•ç¤ºä¿®æ”¹åçš„ä»£ç </p><h2>1 é…ç½®</h2><p>.babelrc</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="662941e3-1627-42e9-b465-3159c382d048" data-macro-schema-version="1" style="background-image: url(/plugins/servlet/confluence/placeholder/macro-heading?definition=e2NvZGV9&amp;locale=zh_CN&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>{
  ...
  "plugins": [
    "react-hot-loader/babel"
  ]
}</pre></td></tr></table><p>å®‰è£…</p><p>@nextè¡¨ç¤ºæ˜¯æµ‹è¯•ç‰ˆï¼Œè¿˜æ²¡å‘å¸ƒåˆ°ä¸»åŒ…</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="dcebd97b-296d-4691-9b95-5cc12635b5fd" data-macro-schema-version="1" style="background-image: url(/plugins/servlet/confluence/placeholder/macro-heading?definition=e2NvZGV9&amp;locale=zh_CN&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>npm i react-hot-loader@next -D</pre></td></tr></table><p>é‡æ–°ç»„ç»‡app.js</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="3c559d81-598b-46b4-b1e7-0055f3a13902" data-macro-schema-version="1" style="background-image: url(/plugins/servlet/confluence/placeholder/macro-heading?definition=e2NvZGV9&amp;locale=zh_CN&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>...
import { AppContainer } from 'react-hot-loader'

const root = document.getElementById("root")
const render = (Component) => {
    ReactDOM.render(
        &lt;AppContainer>
            &lt;Component />
        &lt;/AppContainer>
        ,
        root
    )
};

render(App);

if (module.hot) {
     module.hot.accept('./App.jsx', () => {
         const NextApp = require('./App.jsx').default;
         render(NextApp)
     })
}</pre></td></tr></table><p>è¯´æ˜ï¼š</p><ol><li>è‡ªå®šä¹‰äº†ä¸€ä¸ªrenderæ–¹æ³•ï¼Œç”¨æ¥å®ç°ï¼ŒæŠŠç»„ä»¶æŒ‚è½½åˆ°idä¸ºrootçš„æ ‡ç­¾ä¸­<ul style="list-style-type: square;"><li>AppContainerï¼šå®ç°hot loadå¿…é¡»è¦ç”¨è¿™ä¸ªæ ‡ç­¾åŒ…è£¹æ•´ä¸ªAppæ‰è¡Œ</li></ul></li><li>ifè¯­å¥éƒ¨åˆ†<ul style="list-style-type: square;"><li>é€»è¾‘ï¼šå½“éœ€è¦çƒ­æ›´æ–°çš„æ—¶å€™ï¼Œéœ€è¦é‡æ–°æ¸²æŸ“æ•´ä¸ªApp</li></ul></li></ol><p><br /></p><p>åŸºæœ¬åŠŸèƒ½å®Œæˆï¼Œä½†æ˜¯æœ‰å¾ˆå¤šwarningï¼Œè€Œä¸”åˆ·æ–°å¾ˆæ…¢ï¼Œä¸‹é¢ä¸ºä¼˜åŒ–æ–¹æ³• - è®¾ç½®mode</p><p><br />webpack.config.client.js</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="abe47b26-c7cc-4128-ac5d-9a9b13cc51ca" data-macro-schema-version="1" style="background-image: url(/plugins/servlet/confluence/placeholder/macro-heading?definition=e2NvZGV9&amp;locale=zh_CN&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>...
if (isDev) {
    config.entry = {
        app: [
            'react-hot-loader/patch',
            path.join(__dirname, '../client/app.js')
        ]
    };

    config.devServer = {
        ...
        hot: true,
        ...
    };

    config.mode = 'development';
    
    config.plugins.push(new webpack.HotModuleReplacementPlugin())
}
...</pre></td></tr></table><p>è¯´æ˜ï¼š</p><ol><li>webpackçš„entryå¯ä»¥æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œä»£è¡¨è¿™ä¸ªentryé‡Œé¢åŒ…å«äº†å¾ˆå¤šå¼•ç”¨æ–‡ä»¶ï¼Œéœ€è¦æ‰“åŒ…åˆ°åŒä¸€ä¸ªæ–‡ä»¶ä¸­å»<br /><ul style="list-style-type: square;"><li>è¿™é‡Œæ˜¯è¦æŠŠhot-loaderçš„patchæ‰“åˆ°app.jsä¸­</li><li>ä»¥å®ç°hot loadåŠŸèƒ½</li></ul></li><li>éœ€è¦æ‰“å¼€hoté€‰é¡¹</li><li>éœ€è¦æŠŠæ¨¡å¼è®¾ç½®ä¸ºdevelopmentï¼Œå¦åˆ™webpackä¼šé»˜è®¤å½“å‰ä¸ºç”Ÿäº§ç¯å¢ƒï¼Œå¯¼è‡´hot loadçš„æ—¶å€™å¼‚å¸¸ç¼“æ…¢</li><li>éœ€è¦æŠŠhotmoduleæ’ä»¶ï¼Œé…ç½®åˆ°pluginsé‡Œ</li></ol><h1>0x3 å®æ—¶æœåŠ¡ç«¯æ¸²æŸ“</h1><p><a href="https://gitee.com/azen/FE-execise/commit/dd48c1a7d3a8502dd9313fb7fd494739b6c06fe6">æœ¬èŠ‚Commit</a></p><p>å¼€å‘è¿‡ç¨‹ä¸­ï¼Œä¹Ÿæœ‰ã€Œå®æ—¶æœåŠ¡ç«¯æ¸²æŸ“ã€éœ€æ±‚</p><p>æœåŠ¡ç«¯æ¸²æŸ“ï¼šå°†å®æ—¶ç¼–è¯‘å¥½ &amp; å­˜åœ¨dev serverä¸­çš„ã€ŒæœåŠ¡ç«¯js-bundleã€ï¼Œå’Œdev serverä¸­çš„index.htmlç»“åˆèµ·æ¥ï¼Œè¿”å›æœ€ç»ˆå†…å®¹</p><p>server.jsï¼šæ¸²æŸ“æœåŠ¡å™¨ï¼Œéœ€è¦åŒºåˆ†æ˜¯å¦ä¸ºå¼€å‘ç¯å¢ƒ</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="990a1194-6e0b-4d14-a8d0-7f95759579dc" data-macro-schema-version="1" style="background-image: url(/plugins/servlet/confluence/placeholder/macro-heading?definition=e2NvZGV9&amp;locale=zh_CN&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>const express = require('express');
const ReactSSR = require('react-dom/server');
const fs = require('fs');
const path = require('path');

const isDev = process.env.NODE_ENV === "development";
const app = express();

if (!isDev) {
    const template = fs.readFileSync(path.join(__dirname, '../dist/index.html'), 'utf-8');
    const serverEntry = require('../dist/server-entry.js').default;
    app.use('/public', express.static(path.join(__dirname, '../dist')));
    app.get('*', function (req, res) {
        const appString = ReactSSR.renderToString(serverEntry);
        res.send(template.replace('&lt;!--app-->', appString))
    });
} else {
    const devStatic = require('./util/dev-static');
    devStatic(app);
}

app.listen(2333, function () {
   console.log('ğŸš€ æœåŠ¡èµ·æ¥äº†ï¼Œæ­£åœ¨ç›‘å¬2333ç«¯å£(âœŒï¾Ÿâˆ€ï¾Ÿ)â˜')
});</pre></td></tr></table><p><br /></p><p>server/util/dev-static.jsï¼šç”¨æ¥å®ç°serverçš„devç¯å¢ƒä¸‹ç›¸å…³é€»è¾‘</p><p><strong>part Iï¼šè·å–index.html</strong></p><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="075b03c4-2ae4-446e-8ab2-18dea1701ba9" data-macro-schema-version="1" style="background-image: url(/plugins/servlet/confluence/placeholder/macro-heading?definition=e2NvZGV9&amp;locale=zh_CN&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>const axios = require('axios');

const getTemplate = () => {
    return new Promise((resolve, reject) => {
        axios.get('http://localhost:8787/public/index.html')
            .then((res) => {
                resolve(res.data)
            })
            .catch(reject)
    })
};</pre></td></tr></table><p>éœ€è¦è¿”å›æ¸²æŸ“å®Œæˆä¹‹åçš„å†…å®¹ã€‚æˆ‘ä»¬çŸ¥é“ï¼ŒæœåŠ¡ç«¯æ¸²æŸ“éœ€è¦<strong>ä¸¤ä¸ªä¸œä¸œ</strong>ï¼š</p><ol><li>ç¼–è¯‘å¥½çš„serverç«¯jsbundle</li><li>index.htmlï¼ˆæ³¨å…¥äº†clientç«¯jsbundleçš„ï¼‰</li></ol><ul style="list-style-type: square;"><li style="list-style-type: none;background-image: none;"><ul style="list-style-type: square;"><li>é—®é¢˜ï¼šå¼€å‘ç¯å¢ƒä¸‹ï¼Œindex.htmlå­˜åœ¨dev serverä¸­ï¼Œä¸åœ¨distç›®å½•ä¸‹ï¼ˆæ²¡æœ‰distç›®å½•ï¼‰</li><li>æ€è·¯ï¼šé€šè¿‡httpè¯·æ±‚ï¼Œå‘dev serverè¦è¿™ä¸ªæ–‡ä»¶</li><li>å·¥å…·ï¼šaxiosï¼ˆnodejsä¸‹åšhttpè¯·æ±‚çš„åŒ…ï¼‰<ul style="list-style-type: square;"><li>å®‰è£…ï¼š`npm i axios -S`</li></ul></li></ul></li></ul><p><strong>part IIï¼šè·å–ç¼–è¯‘å¥½çš„server-jsbundle</strong></p><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="5308076a-0105-42f7-bef7-78bc188f960f" data-macro-schema-version="1" style="background-image: url(/plugins/servlet/confluence/placeholder/macro-heading?definition=e2NvZGV9&amp;locale=zh_CN&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>... part I ...


const webpack = require('webpack');
const path = require('path');
const serverConfig = require('../../build/webpack.config.server'); // #1

const serverCompiler = webpack(serverConfig);   // #2

const MemoryFs = require('memory-fs');
const mfs = new MemoryFs;
serverCompiler.outputFileSystem = mfs;  //  #4

const Module = module.constructor;
let serverBundle;   //  #5

serverCompiler.watch({}, (err, stats) => {
    if (err) throw err;
    stats = stats.toJson();
    stats.errors.forEach(err => console.error(err));
    stats.warnings.forEach(warn => console.warn(warn));

    const bundlePath = path.join(serverConfig.output.path, serverConfig.output.filename)    // #3
    const serverBundleString = mfs.readFileSync(bundlePath, 'utf-8');   //  #4
    
    const m = new Module();
    m._compile(serverBundleString, 'server-entry.js');
    serverBundle = m.exports.default;   //  #5
});

const ReactDomServer = require('react-dom/server'); //  #6

module.exports = function (app) {
     app.get('*', function (req, res) {
         getTemplate().then((index) => {
             const appString = ReactDomServer.renderToString(serverBundle);
             res.send(index.replace('&lt;!--app-->', appString));
         })
     })
};</pre></td></tr></table><p>è¯´æ˜ï¼š</p><ol><li>æ‹¿åˆ°webpackçš„serveré…ç½®æ–‡ä»¶</li><li>é€šè¿‡é…ç½®ï¼Œå¯åŠ¨ä¸€ä¸ªwebpackçš„ç¼–è¯‘å™¨<ul><li>å¯ä»¥ç›‘å¬entryä¸‹çš„æ–‡ä»¶æ˜¯å¦æœ‰å˜åŒ–ï¼Œä¸€æ—¦å˜åŒ–ä¼šé‡æ–°æ‰“åŒ…</li><li>è¿™ä¸€éƒ¨åˆ†ï¼Œä¸ºå•¥èƒ½è¿™æ ·åšå‘¢ï¼Ÿ<ul><li>å› ä¸ºwebpackæœ¬èº«å°±æä¾›äº†ä¸€ä¸ªåœ¨nodejsä¸­ä½œä¸ºæ¨¡å—è°ƒç”¨çš„æ–¹å¼</li><li>å®ƒä¸ä»…ä»…æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œæ‰“åŒ…å·¥å…·</li><li>è¿˜è®©æˆ‘ä»¬åœ¨æœåŠ¡ç«¯æ¸²æŸ“çš„æ—¶å€™ï¼Œèƒ½æ‹¿åˆ°å®ƒæ‰“åŒ…å‡ºæ¥çš„å†…å®¹ï¼Œç”¨äºæœåŠ¡ç«¯æ¸²æŸ“</li></ul></li></ul></li><li>æ‹¿åˆ°æ‰“å‡ºæ¥çš„jsbundleçš„Path</li><li>è®©æ–‡ä»¶çš„è¯»å†™éƒ½åœ¨å†…å­˜ä¸­æ‰§è¡Œï¼Œè€ŒéDiskï¼Œä»¥æé«˜é€Ÿåº¦<ul><li>å·¥å…·ï¼šmemory-fs</li><li>å®‰è£…ï¼š`npm i memory-fs -D`</li><li>æ³¨æ„ï¼šè¯»å–å‡ºæ¥çš„æ˜¯ç¼–è¯‘å¥½çš„stringï¼Œè€Œéå¯æ‰§è¡Œçš„moduleï¼Œéœ€è¦æŠŠstringæ„å»ºæˆmoduleæ‰è¡Œ</li><li>æç¤ºï¼šMemoryFså’Œnodejsä¸­disk FSçš„apiæ˜¯ä¸€è‡´çš„ï¼Œåªä¸è¿‡å®ç°åšäº†æ›¿æ¢<ul><li>è¾“å‡ºåˆ°å†…å­˜è€Œä¸æ˜¯ç¡¬ç›˜</li></ul></li></ul></li><li>stringæ„å»ºmodule<ul><li>æ‹¿åˆ°å½“å‰moduleçš„æ„é€ å™¨</li><li>ç”¨æ„é€ å™¨æŠŠstringæ„é€ æˆçœŸæ­£çš„module<ul><li>ä½¿ç”¨è¿™ä¸ªapiçš„æ—¶å€™ï¼Œéœ€è¦æŒ‡å®šå®ƒçš„åå­—</li><li>æŒ‡å®šæ–‡ä»¶åï¼Œä¸ç„¶æ— æ³•åœ¨ç¼“å­˜ä¸­å­˜å‚¨è¿™éƒ¨åˆ†å†…å®¹</li><li>æŒ‡å®šæ–‡ä»¶ååï¼Œä¸‹æ¬¡è¯»è¿™éƒ¨åˆ†å†…å®¹ï¼Œæ‰èƒ½æ‹¿åˆ°å®ƒ</li></ul></li><li>è·å¾—ç¼–è¯‘å¥½çš„bundle<ul><li>æ³¨æ„ï¼šéœ€è¦å…ˆexportså‡ºæ¥</li><li>è¿™ä¸ªæ¨¡å—æ˜¯é€šè¿‡exportsæŒ‚è½½ä»æ¨¡å—é‡Œæ‰”å‡ºæ¥çš„ä¸œè¥¿çš„ï¼Œæ‰€ä»¥æƒ³è¦è·å–ä¸œè¥¿ï¼Œä¸€å®šéœ€è¦å…ˆexports</li></ul></li></ul></li><li>ä½¿ç”¨react-dom/serverï¼ŒæŠŠæ‹¿åˆ°çš„index.htmlå’Œserver-js-bundleæ¸²æŸ“æˆæœ€ç»ˆhtml</li></ol><p><br /></p><p>é…ç½®npmå¯åŠ¨è„šæœ¬</p><p>package.json</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="4f6b1e76-8348-4b8f-9369-afdc3ad8a4da" data-macro-schema-version="1" style="background-image: url(/plugins/servlet/confluence/placeholder/macro-heading?definition=e2NvZGV9&amp;locale=zh_CN&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>{
    ...
    "dev:web:start": "cross-env NODE_ENV=development node server/server.js"
    ...
}</pre></td></tr></table><p><br /></p><p>é—®é¢˜ï¼šç”Ÿæˆçš„htmlæ–‡ä»¶ä¸­ï¼Œå¼•å…¥çš„jsæ–‡ä»¶ä¸èƒ½æ­£ç¡®è¯·æ±‚ - è¯·æ±‚è¿”å›å€¼æ˜¯index.htmlï¼Œè€Œä¸æ˜¯æˆ‘ä»¬éœ€è¦çš„jsæ–‡ä»¶çœŸæ­£å†…å®¹</p><p>è§£å†³æ–¹æ¡ˆï¼š</p><ul><li>ä¸ºäº†è®©ã€Œé™æ€èµ„æºæ–‡ä»¶ã€å¯ä»¥æ­£ç¡®è¯·æ±‚åˆ°ï¼Œéœ€è¦ä½¿ç”¨ä¸­é—´ä»¶</li><li>å¼€å‘ç¯å¢ƒä¸‹ï¼Œå®¢æˆ·ç«¯çš„jsï¼Œéƒ½æ˜¯åœ¨webpack dev serverå­˜å‚¨çš„ï¼Œé€šè¿‡ä¸€ä¸ªhttpæœåŠ¡è¯·æ±‚åˆ°çš„</li><li>æˆ‘ä»¬éœ€è¦é€šè¿‡ä»£ç†ï¼ŒæŠŠé™æ€æ–‡ä»¶å…¨éƒ¨ä»£ç†åˆ°webpack dev serveræœåŠ¡ï¼Œä»é‡Œé¢æ‹¿é™æ€èµ„æº</li></ul><p>server.js ä¿®é¥°</p><table class="wysiwyg-macro" data-macro-name="code" data-macro-id="469a8d52-6874-4c48-9532-077a44cf12cd" data-macro-schema-version="1" style="background-image: url(/plugins/servlet/confluence/placeholder/macro-heading?definition=e2NvZGV9&amp;locale=zh_CN&amp;version=2); background-repeat: no-repeat;" data-macro-body-type="PLAIN_TEXT"><tr><td class="wysiwyg-macro-body"><pre>...
module.exports = function (app) {
    const proxy = require('http-proxy-middleware');
    app.use('/public', proxy({target: 'http://localhost:8787'}));
    ...
};</pre></td></tr></table><p>è¯´æ˜ï¼š</p><ul style="list-style-type: square;"><li>å®‰è£…ï¼š`npm i http-proxy-middleware -D`</li><li>æŒ‡å®š/publicä¸‹æ–‡ä»¶ï¼Œä½¿ç”¨proxyåšè½¬å‘</li></ul><p>å¯åŠ¨</p><ul style="list-style-type: square;"><li>éœ€è¦å…ˆå¯åŠ¨dev:clientï¼Œå†å¯åŠ¨dev:web:start</li></ul><p><br /></p><p>warningç›¸å…³å‚è€ƒæ–‡æ¡£ï¼š</p><ol><li><span style="color: rgb(36,39,41);"><a href="https://stackoverflow.com/questions/34060968/react-warning-render">Warning: render(): Target node has markup rendered by Reac</a><a href="https://stackoverflow.com/questions/34060968/react-warning-render">t... </a></span></li></ol>
        <p>&nbsp;</p>
    

</div>


    </div>

    
  </body>
</html>